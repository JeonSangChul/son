<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="son.board.dao.BoardMapper">

    <select id="selectBoardList" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        	SELECT idx
        		   ,title
        		   ,user_id
        		   ,DATE_FORMAT(create_dt,'%Y-%m-%d') as create_dt
        	  FROM board
        	  ORDER BY idx desc
        	 LIMIT #{start} , #{pageSize}
        	 
        ]]>
    </select>
    
    <select id="selectBoardListTotCnt" parameterType="paramMap" resultType="integer">
        <![CDATA[
        	SELECT count(*)
        	  FROM board
        ]]>
    </select>
    
    <insert id="boardInsert" parameterType="paramMap">
        <![CDATA[
        	INSERT INTO board
        			( user_id
        			 ,title
        			 ,content
        			 ,img_id
        			 ,create_dt
        			 ,update_dt
        			)
        		values 	( 'son'
        				 ,#{title}
        				 ,#{content}
        				 ,#{imgId}
        				 ,now()
        				 ,now()
        				)
        ]]>
        <selectKey keyProperty="idx" resultType="Integer">
            <![CDATA[
            	SELECT LAST_INSERT_ID();
            ]]>
        </selectKey>
    </insert>
    
    <insert id="boardImgInsert" parameterType="paramMap">
        <![CDATA[
        	INSERT INTO board_image
        			( create_dt
        			)
        		VALUES (  now()
        			   )
        ]]>
        <selectKey keyProperty="imgId" resultType="Integer">
            <![CDATA[
            	SELECT LAST_INSERT_ID();
            ]]>
        </selectKey>
    </insert>
    
    <insert id="boardImgDetailInsert" parameterType="paramMap">
        <selectKey keyProperty="imgSrno" resultType="Integer" order="BEFORE">
            <![CDATA[
            	(SELECT IFNULL(MAX(img_srno),0)+1 AS imgSrno FROM board_image_detail WHERE IMG_ID = #{imgId})
            ]]>
        </selectKey>
        
        <![CDATA[
        	INSERT INTO board_image_detail
        			( img_id
        			 ,img_srno
        			 ,origin_file_name
        			 ,stored_file_name
        			 ,file_size
        			 ,file_path
        			)
        		VALUES (  #{imgId}
        				 ,#{imgSrno}
        				 ,#{originFileName}
        				 ,#{storedName}
        				 ,#{fileSize}
        				 ,#{filePath}
        			   )
        ]]>
    </insert>
    
    <select id="selectBoardDetail" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        	SELECT idx
        	       ,title
        	       ,content
        	       ,user_id
        	       ,DATE_FORMAT(create_dt,'%Y-%m-%d') create_dt
        	       ,img_id
        	  FROM board
        	 WHERE 1=1
        	   AND idx = #{idx}
        ]]>
    </select>
    
    <select id="selectImgList" parameterType="paramMap" resultType="egovMap">
        <![CDATA[
        	SELECT t2.img_id
        		  ,t2.img_srno
        		  ,t2.origin_file_name
        		  ,t2.stored_file_name
        		  ,t2.file_size
        		  ,t2.file_path
        		  ,t2.file_extsn
        	  FROM board_image t1
        	      ,board_image_detail t2
        	 WHERE 1=1
        	   AND t1.img_id = t2.img_id
        	   and t1.img_id = #{imgId}
        ]]>
    </select>
</mapper>